@page
@model IndexModel
@{
    ViewData["Title"] = "Formulár";
}
<!DOCTYPE html>
<html lang="sk">
<head>
    <title>Formulár pre účastníkov</title>
</head>
<body>
    <form method="post">
        <fieldset>
            <legend>Účastníci</legend>
            <ul id="ucastnici">
                <!-- Existing participants will be displayed here -->
            </ul>
            <button type="button" id="pridat-ucastnika">Pridať účastníka</button>
            <button type="submit" id="odoslat-posledny-ucastnik">Ulož XML</button>
        </fieldset>
    </form>

    <script>
        // počiatočná hodnota počtu účastníkov
        let pocet_ucastnikov = 1;

        // funkcia na pridanie nového účastníka
        function pridatUcastnika() {

            // kontrola, či je počet účastníkov menší ako 10
            if (pocet_ucastnikov > 10) {
                // zablokovanie tlačidla "Pridať účastníka"
                alert("Maximálny počet účastníkov je 10.");
                return;
            }

            // vytvorenie nového prvku <li>
            let novyUcastnik = document.createElement("li");

            // pridanie potrebných polí
            novyUcastnik.innerHTML = `
                <h2>Účastník ${pocet_ucastnikov}</h2>
                <label for="Participants[${pocet_ucastnikov}].Name">Meno:</label>
                <input type="text" name="Participants[${pocet_ucastnikov}].Name" id="ucastnik_${pocet_ucastnikov}_meno" required pattern="^[a-zA-Z]+$">
                <label for="Participants[${pocet_ucastnikov}].Surname">Priezvisko:</label>
                <input type="text" name="Participants[${pocet_ucastnikov}].Surname" id="ucastnik_${pocet_ucastnikov}_priezvisko" required pattern="^[a-zA-Z]+$">
                <label for="Participants[${pocet_ucastnikov}].Date">Dátum narodenia:</label>
                <input type="date" name="Participants[${pocet_ucastnikov}].Date" id="ucastnik_${pocet_ucastnikov}_datum_narodenia" required>
                <label for="Participants[${pocet_ucastnikov}].Age">Vek:</label>
                <input type="number" name="Participants[${pocet_ucastnikov}].Age" id="ucastnik_${pocet_ucastnikov}_vek" required min="1">
                <label for="Participants[${pocet_ucastnikov}].Email">E-mail:</label>
                <input type="email" name="Participants[${pocet_ucastnikov}].Email" id="ucastnik_${pocet_ucastnikov}_email" placeholder="me@example.com" required>
            `;

            // pridanie nového prvku na koniec zoznamu
            document.getElementById("ucastnici").appendChild(novyUcastnik);

            // zvýšenie počtu účastníkov
            pocet_ucastnikov++;
        }

        document.getElementById("pridat-ucastnika").addEventListener("click", pridatUcastnika);
    </script>

    <h2 class="display-5">Nahraj XML súbor a porovnaj s XSD</h2>
    <form method="post" asp-page-handler="UploadXml" enctype="multipart/form-data">
        <input id="file-upload" type="file" name="xmlFile" accept=".xml" required />
        <button type="submit">Porovnaj</button>
    </form>

@if (TempData["result"] != null)
{
    <script>
        // Check if TempData["result"] is not null
        var resultMessage = "@TempData["result"]";

        // Create a temporary element to decode HTML entities
        var tempElement = document.createElement("div");
        tempElement.innerHTML = resultMessage;
        var decodedMessage = tempElement.textContent;

        if (decodedMessage.trim() !== "") {
            alert(decodedMessage);
        }
    </script>
}

    @if (ViewData["PopupMessage"] != null)
    {
        <div id="popupMessage">@ViewData["PopupMessage"]</div>
        // pop up message not working
        <script>
            showPopup('@ViewData["PopupMessage"]');
        </script>
    }
</body>
</html>